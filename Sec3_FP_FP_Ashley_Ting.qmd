---
title: "How Have Food CPI Trends Changed Over the Past Two Decades?"
author: "Ashley Song"
date: "December 17, 2025"
format:
  pdf:
    toc: false
    geometry:
      - margin=1in
    fig-pos: "H"
execute:
  echo: false
  warning: false
  message: false
---

```{r setup}
#| echo: false
# Following the Tidyverse Style Guide

library(tidyverse)
library(knitr)

# Reproducibility note:
# This QMD assumes you are rendering from the repository root (the folder that contains "Data Sources (CSV)/").
# If you get a "file does not exist" error, set your working directory to the repo root and re-render.

data_dir <- "Data Sources (CSV)"
hist_path <- file.path(data_dir, "historicalcpi.csv")
fc_path   <- file.path(data_dir, "CPIForecast.csv")

if (!file.exists(hist_path) || !file.exists(fc_path)) {
  stop(
    paste0(
      "Required CSVs not found.\n",
      "Expected paths:\n- ", hist_path, "\n- ", fc_path, "\n\n",
      "Fix: render from the repo root (where the 'Data Sources (CSV)' folder exists)."
    )
  )
}

historical_raw <- read_csv(hist_path, show_col_types = FALSE)
forecast_raw   <- read_csv(fc_path, show_col_types = FALSE)
```

# Introduction

Food prices are one of the most visible ways households experience inflation. In this project, we focus on **year-to-year percent changes in the U.S. Consumer Price Index (CPI) for food** to answer:

**How have food CPI trends changed over the past two decades (2005–2024), and what do USDA forecasts suggest for 2025–2026?**

We analyze overall **All food** inflation and compare patterns for four specific “food at home” categories: **Eggs, Pork, Beef and veal, and Fresh fruits**. We include USDA midpoint forecasts for 2025–2026 to provide short-term context.

# Data provenance

We use the USDA Economic Research Service (ERS) Food Price Outlook datasets, which include:
- Historical CPI percent changes by item and year
- Forecast prediction intervals, from which we use the **midpoint** values for 2025 and 2026

Data Source: USDA ERS, *Food Price Outlook* (downloaded as CSV and stored in this repo).  

# Fair and CARE principles

**Fairness.** This analysis is descriptive: it summarizes CPI percent changes and USDA forecasts. We avoid making claims about specific households or groups, and we do not impute impacts on different populations. CPI is an aggregate measure and may not reflect individual shopping patterns.

**CARE (Collective Benefit, Authority to Control, Responsibility, Ethics).**
- **Collective benefit:** We aim to present transparent, interpretable summaries of food inflation trends.
- **Authority to control:** Data are publicly provided by USDA ERS; we preserve source attribution.
- **Responsibility:** We document transformations and keep the workflow reproducible within the repository.
- **Ethics:** We clearly label forecasts vs historical values and do not treat forecasts as observed truth.

# Attributes used

Key attributes used in the wrangling:
- `Year` (historical) and forecast year parsed from `Attribute`
- `Consumer Price Index item` (historical CPI item name)
- Hierarchy columns in the forecast file (e.g., `Top-level`, `Aggregate`, `Mid-level`, `Low-level`, `Disaggregate`)
- `Percent change` (historical CPI percent change)
- `Value` (forecast midpoint percent change)
- A derived `type` label: `Historical` vs `Forecast`

# Methods summary

1. Filter historical data to the period **2005–2024** and select relevant CPI items.
2. Filter forecast data to the **midpoint** prediction interval values for **2025–2026**.
3. Combine historical and forecast values.
4. Visualize long-run trends, category comparisons, and distributional summaries.
5. Create summary tables for interpretation.

# Results

## Visualization 1: All food CPI over time (historical + forecast)

This time-series plot shows that U.S. food inflation is not steady: it rises and falls over time with a noticeable spike in the early 2020s. The dashed segment shows USDA midpoint forecasts for 2025–2026, which suggest inflation returning to more moderate levels compared to the recent peak years.

```{r fig_allfood_trend}
#| echo: false
#| fig-width: 8
#| fig-height: 5
#| out-width: "100%"
#| fig-cap: "All food CPI percent change (historical values and USDA forecast midpoints), 2005–2026."
#| fig-alt: "Time-series line chart of U.S. All food CPI percent change by year from 2005 to 2026. Historical values from 2005–2024 appear as a solid black line with points. Forecast midpoint values for 2025–2026 appear as a dashed blue line with points. The x-axis is Year and the y-axis is Percent change (%)."

# Code Header: Primary Author: Ting Huang | Reviewer: Ashley Song

allfood_hist <- historical_raw %>%
  filter(str_detect(`Consumer Price Index item`, "All food"),
         Year >= 2005, Year <= 2024) %>%
  mutate(Year = as.integer(Year)) %>%
  rename(pct_change = `Percent change`) %>%
  mutate(type = "Historical") %>%
  select(Year, pct_change, type)

allfood_fc <- forecast_raw %>%
  filter(`Top-level` == "All food") %>%
  filter(is.na(Aggregate)) %>%
  filter(Attribute %in% c("Mid point of prediction interval 2025",
                          "Mid point of prediction interval 2026")) %>%
  mutate(
    Year       = parse_number(Attribute),
    pct_change = Value,
    type       = "Forecast"
  ) %>%
  select(Year, pct_change, type)

forecast_line <- allfood_hist %>%
  filter(Year == 2024) %>%
  mutate(type = "Forecast") %>%
  bind_rows(allfood_fc %>% mutate(type = "Forecast"))

lines_df <- bind_rows(
  allfood_hist %>% mutate(type = "Historical"),
  forecast_line
) %>%
  mutate(type = factor(type, levels = c("Historical", "Forecast")))

points_df <- bind_rows(
  allfood_hist %>% mutate(type = "Historical"),
  allfood_fc   %>% mutate(type = "Forecast")
) %>%
  mutate(type = factor(type, levels = c("Historical", "Forecast")))

food_cpi_plot <- ggplot(lines_df,
                        aes(x = Year,
                            y = pct_change,
                            linetype = type,
                            color    = type)) +
  geom_line(linewidth = 1) +
  geom_point(data = points_df,
             aes(x = Year, y = pct_change,
                 color = type),
             size = 2) +
  scale_linetype_manual(
    name   = "Data type",
    breaks = c("Historical", "Forecast"),
    values = c("Historical" = "solid",
               "Forecast"   = "dashed"),
    labels = c("Historical values (2005–2024)",
               "Forecast values (2025–2026)")
  ) +
  scale_color_manual(
    name   = "Data type",
    breaks = c("Historical", "Forecast"),
    values = c("Historical" = "black",
               "Forecast"   = "blue"),
    labels = c("Historical values (2005–2024)",
               "Forecast values (2025–2026)")
  ) +
  labs(
    title    = "U.S. Food Inflation Rate (All food CPI Percent Change), 2005–2026",
    subtitle = "2005–2024 are historical All food CPI percent changes; 2025–2026 are USDA forecast midpoints",
    x        = "Year",
    y        = "Percent change (%)",
    caption  = "Source: USDA Economic Research Service, Food Price Outlook"
  ) +
  theme_minimal(base_size = 13) +
  theme(
    legend.position = "right",
    plot.title      = element_text(face = "bold"),
    plot.subtitle   = element_text(margin = margin(b = 8))
  )

food_cpi_plot
```

**Long description:** The chart traces annual percent changes in All food CPI. Values fluctuate over time and include a prominent surge in the early 2020s. The forecast segment (dashed) extends from the last historical point and shows the predicted direction for 2025–2026.

## Visualization 2: Category trends (lines)

Comparing categories shows that inflation does not move uniformly across foods. Some categories display larger volatility (bigger spikes and drops) than others. This helps explain why consumers may feel food inflation differently depending on what they buy most often.

```{r fig_category_lines}
#| echo: false
#| fig-width: 9
#| fig-height: 5.5
#| out-width: "100%"
#| fig-cap: "Food CPI percent change by category (historical values and USDA forecast midpoints), 2005–2026."
#| fig-alt: "Multi-line time-series plot of CPI percent change from 2005 to 2026 for Eggs, Pork, Beef and veal, and Fresh fruits. Historical values (2005–2024) are shown with solid lines and points, and forecast midpoints (2025–2026) are shown as dashed extensions. The x-axis is Year and the y-axis is Percent change (%). Colors and shapes distinguish food categories."

# Code Header: Primary Author: Ting Huang | Reviewer: Ashley Song

items4 <- c("Eggs", "Pork", "Beef and veal", "Fresh fruits")

hist_4items <- historical_raw %>%
  filter(`Consumer Price Index item` %in% items4,
         Year >= 2005, Year <= 2024) %>%
  mutate(
    item       = `Consumer Price Index item`,
    Year       = as.integer(Year),
    pct_change = `Percent change`,
    type       = "Historical"
  ) %>%
  select(item, Year, pct_change, type)

eggs_fc <- forecast_raw %>%
  filter(`Top-level` == "All food",
         Aggregate   == "Food at home",
         `Mid-level` == "Eggs",
         str_detect(Attribute, "Mid point of prediction interval")) %>%
  mutate(
    item       = "Eggs",
    Year       = parse_number(Attribute),
    pct_change = Value,
    type       = "Forecast"
  ) %>%
  filter(Year %in% c(2025, 2026)) %>%
  select(item, Year, pct_change, type)

pork_fc <- forecast_raw %>%
  filter(`Top-level` == "All food",
         Aggregate   == "Food at home",
         `Mid-level` == "Meats, poultry, and fish",
         `Low-level` == "Meats",
         Disaggregate == "Pork",
         str_detect(Attribute, "Mid point of prediction interval")) %>%
  mutate(
    item       = "Pork",
    Year       = parse_number(Attribute),
    pct_change = Value,
    type       = "Forecast"
  ) %>%
  filter(Year %in% c(2025, 2026)) %>%
  select(item, Year, pct_change, type)

beef_fc <- forecast_raw %>%
  filter(`Top-level` == "All food",
         Aggregate   == "Food at home",
         `Mid-level` == "Meats, poultry, and fish",
         `Low-level` == "Meats",
         Disaggregate == "Beef and veal",
         str_detect(Attribute, "Mid point of prediction interval")) %>%
  mutate(
    item       = "Beef and veal",
    Year       = parse_number(Attribute),
    pct_change = Value,
    type       = "Forecast"
  ) %>%
  filter(Year %in% c(2025, 2026)) %>%
  select(item, Year, pct_change, type)

freshfruits_fc <- forecast_raw %>%
  filter(`Top-level` == "All food",
         Aggregate   == "Food at home",
         `Mid-level` == "Fruits and vegetables",
         `Low-level` == "Fresh fruits and vegetables",
         `Disaggregate` == "Fresh fruits",
         str_detect(Attribute, "Mid point of prediction interval")) %>%
  mutate(
    item       = "Fresh fruits",
    Year       = parse_number(Attribute),
    pct_change = Value,
    type       = "Forecast"
  ) %>%
  filter(Year %in% c(2025, 2026)) %>%
  select(item, Year, pct_change, type)

fc_4items <- bind_rows(eggs_fc, pork_fc, beef_fc, freshfruits_fc)

forecast_line_4items <- hist_4items %>%
  filter(Year == 2024) %>%
  mutate(type = "Forecast") %>%
  bind_rows(fc_4items)

lines_4items <- bind_rows(hist_4items, forecast_line_4items) %>%
  mutate(
    type = factor(type, levels = c("Historical", "Forecast")),
    item = factor(item, levels = c("Eggs", "Pork", "Beef and veal", "Fresh fruits"))
  )

points_4items <- bind_rows(hist_4items, fc_4items) %>%
  mutate(
    type = factor(type, levels = c("Historical", "Forecast")),
    item = factor(item, levels = c("Eggs", "Pork", "Beef and veal", "Fresh fruits"))
  )

cpi_4items_plot <- ggplot(lines_4items,
                          aes(x = Year,
                              y = pct_change,
                              color    = item,
                              linetype = type)) +
  geom_line(linewidth = 1) +
  geom_point(data = points_4items,
             aes(shape = item, color = item),
             size = 2) +
  scale_linetype_manual(
    name   = "Data type",
    values = c("Historical" = "solid",
               "Forecast"   = "dashed"),
    labels = c("Historical (2005–2024)",
               "Forecast (2025–2026)")
  ) +
  scale_color_manual(
    name   = "Food category",
    values = c("Eggs"          = "orange",
               "Pork"          = "pink",
               "Beef and veal" = "darkgreen",
               "Fresh fruits"  = "yellow")
  ) +
  scale_shape_manual(
    name   = "Food category",
    values = c("Eggs"          = 16,
               "Pork"          = 17,
               "Beef and veal" = 15,
               "Fresh fruits"  = 18)
  ) +
  labs(
    title    = "Food Inflation by Category (CPI Percent Change), 2005–2026",
    subtitle = "Historical percent changes (2005–2024), plus USDA midpoint forecasts for 2025–2026",
    x        = "Year",
    y        = "Percent change (%)",
    caption  = "Source: USDA Economic Research Service, Food Price Outlook"
  ) +
  theme_minimal(base_size = 13) +
  theme(
    legend.position = "right",
    plot.title      = element_text(face = "bold"),
    plot.subtitle   = element_text(margin = margin(b = 8))
  )

cpi_4items_plot
```

**Long description:** Each category is a colored line across years. Solid portions show historical values (2005–2024) and dashed portions show forecasts (2025–2026). The spacing between lines and the presence of sharp peaks indicate differences in volatility by category.

## Visualization 3: Category comparison (grouped bars)

The grouped bar chart provides another view of category differences. Because bars are side-by-side within each year, it is easier to compare categories at a single time point. Forecast bars are lighter to emphasize that they are predicted values.

```{r fig_category_bars}
#| echo: false
#| fig-width: 10
#| fig-height: 6
#| out-width: "100%"
#| fig-cap: "Grouped bar chart comparing CPI percent change across food categories, 2005–2026."
#| fig-alt: "Grouped bar chart of CPI percent change by year for Eggs, Pork, Beef and veal, and Fresh fruits from 2005 to 2026. Different colors represent categories, and bar transparency indicates data type: historical values are more opaque and forecast values are lighter. The x-axis is Year and the y-axis is Percent change (%)."

# Code Header: Primary Author: Ting Huang | Reviewer: Ashley Song

cpi_4items_all <- bind_rows(hist_4items, fc_4items) %>% 
  mutate(
    type = factor(type, levels = c("Historical", "Forecast")),
    item = factor(item, levels = c("Eggs", "Pork", "Beef and veal", "Fresh fruits"))
  )

cpi_4items_bar <- ggplot(
  cpi_4items_all,
  aes(x = factor(Year),
      y = pct_change,
      fill  = item,
      alpha = type)
) +
  geom_col(position = position_dodge(width = 0.8)) +
  scale_fill_manual(
    name   = "Food category",
    values = c("Eggs"          = "orange",
               "Pork"          = "firebrick",
               "Beef and veal" = "darkgreen",
               "Fresh fruits"  = "royalblue")
  ) +
  scale_alpha_manual(
    name   = "Data type",
    values = c("Historical" = 1,
               "Forecast"   = 0.5),
    labels = c("Historical (2005–2024)",
               "Forecast (2025–2026)")
  ) +
  labs(
    title    = "Food Inflation by Category (CPI Percent Change), 2005–2026",
    subtitle = "Bars show yearly percent changes; lighter bars indicate USDA midpoint forecasts for 2025–2026",
    x        = "Year",
    y        = "Percent change (%)",
    caption  = "Source: USDA Economic Research Service, Food Price Outlook"
  ) +
  theme_minimal(base_size = 13) +
  theme(
    legend.position = "right",
    plot.title      = element_text(face = "bold"),
    plot.subtitle   = element_text(margin = margin(b = 8)),
    axis.text.x     = element_text(angle = 45, hjust = 1)
  )

cpi_4items_bar
```

**Long description:** For each year, four colored bars represent the four categories. Forecast-year bars appear lighter (more transparent). The chart highlights differences in inflation magnitude within the same year.

## Table 1: Summary of historical levels and forecasts

This table summarizes each category’s historical mean, minimum, and maximum percent change (2005–2024), alongside USDA midpoint forecasts for 2025 and 2026. It provides an at-a-glance comparison of typical inflation and the range of volatility for each category.

```{r tbl_summary_4items}
#| echo: false
#| tbl-cap: "Summary of food inflation by category: historical averages (2005–2024) and USDA forecasts (2025–2026)."

# Code Header: Primary Author: Ting Huang | Reviewer: Ashley Song

summary_4items <- hist_4items %>%
  group_by(item) %>%
  summarise(
    mean_2005_2024 = mean(pct_change, na.rm = TRUE),
    min_2005_2024  = min(pct_change, na.rm = TRUE),
    max_2005_2024  = max(pct_change, na.rm = TRUE)
  ) %>%
  left_join(
    fc_4items %>%
      select(item, Year, pct_change) %>%
      tidyr::pivot_wider(
        names_from  = Year,
        values_from = pct_change,
        names_prefix = "forecast_"
      ),
    by = "item"
  ) %>%
  mutate(
    across(where(is.numeric), ~ round(.x, 1))
  ) %>%
  arrange(item)

summary_4items_pretty <- summary_4items %>%
  rename(
    Item                 = item,
    `Mean 2005–2024 (%)` = mean_2005_2024,
    `Min 2005–2024 (%)`  = min_2005_2024,
    `Max 2005–2024 (%)`  = max_2005_2024,
    `Forecast 2025 (%)`  = forecast_2025,
    `Forecast 2026 (%)`  = forecast_2026
  ) %>%
  arrange(Item)

knitr::kable(
  as.data.frame(summary_4items_pretty),
  booktabs = TRUE
)
```

## Table 2: Extremes in All food inflation (historical)

To complement the trend plot, this table isolates the most extreme historical years in the All food series. Extreme years can help explain “why the line looks the way it does” and provides concrete values for discussion.

```{r tbl_allfood_extremes}
#| echo: false
#| tbl-cap: "Extremes in U.S. food inflation (All food CPI): three highest and three lowest annual percent changes, 2005–2024."

# Code Header: Primary Author: Ting Huang | Reviewer: Ashley Song

allfood_extremes <- allfood_hist %>%
  select(Year, pct_change) %>%
  arrange(desc(pct_change)) %>%
  slice_head(n = 3) %>%
  mutate(Rank = paste0("Highest #", row_number())) %>%
  bind_rows(
    allfood_hist %>%
      select(Year, pct_change) %>%
      arrange(pct_change) %>%
      slice_head(n = 3) %>%
      mutate(Rank = paste0("Lowest #", row_number()))
  ) %>%
  mutate(pct_change = round(pct_change, 1)) %>%
  select(Rank, Year, pct_change) %>%
  arrange(desc(pct_change))

allfood_extremes_pretty <- allfood_extremes %>%
  rename(`Percent change (%)` = pct_change)

knitr::kable(
  as.data.frame(allfood_extremes_pretty),
  booktabs = TRUE
)
```

## Visualization 4: Distribution of All food inflation (historical)

The distribution view answers a different question than the time-series: instead of “when did inflation rise,” it asks “what do typical inflation years look like?” The histogram shows most years cluster around low-to-moderate inflation, while a smaller number of years have unusually high inflation.

```{r fig_allfood_distribution}
#| echo: false
#| fig-width: 8
#| fig-height: 5
#| out-width: "100%"
#| fig-cap: "Distribution of annual All food CPI percent changes (historical only), 2005–2024."
#| fig-alt: "Histogram of annual All food CPI percent changes from 2005 to 2024 with a smooth density curve overlaid. Bars show counts of years in each percent-change bin. The x-axis is Percent change (%) and the y-axis is Count."

# Code Header: Primary Author: Ting Huang | Reviewer: Ashley Song

allfood_dist_plot <- ggplot(allfood_hist, aes(x = pct_change)) +
  geom_histogram(
    binwidth = 1,
    boundary = 0,
    fill = "steelblue",
    color = "white",
    alpha = 0.7
  ) +
  geom_density(aes(y = after_stat(density) * 1), linewidth = 1) +
  labs(
    title = "Distribution of U.S. Food Inflation Rate (All food CPI), 2005–2024",
    subtitle = "Histogram of yearly CPI percent changes with a density curve",
    x = "Percent change (%)",
    y = "Count",
    caption = "Source: USDA Economic Research Service, Food Price Outlook"
  ) +
  theme_minimal(base_size = 13)

allfood_dist_plot
```

**Long description:** Most years fall into low-to-moderate percent changes, while the density curve shows the overall shape and highlights the presence of a right tail from a small number of high-inflation years.

# Author contributions

- **Ting Huang (Primary Author):** data wrangling workflow, forecast filtering logic, and initial visualizations/tables.
- **Ashley Song (Reviewer/Contributor):** repository organization, reproducibility improvements (relative paths), visualization sizing adjustments in Quarto, and narrative writing/interpretation additions.

# Code Appendix

Below is the full code used to generate the results in this document.

```{r code_appendix_full}
#| echo: true

# Install tidyverse 
install.packages("tidyverse")
library(tidyverse)

# Load CPI data (reproducible within GitHub)
historical_raw <- read_csv("Data Sources (CSV)/historicalcpi.csv")
forecast_raw   <- read_csv("Data Sources (CSV)/CPIForecast.csv")

View(historical_raw) 
View(forecast_raw)   

# Data wrangling + cleaning: All food CPI (Historical: 2005–2024)
allfood_hist <- historical_raw %>%
  filter(str_detect(`Consumer Price Index item`, "All food"),
         Year >= 2005, Year <= 2024) %>%
  mutate(Year = as.integer(Year)) %>%
  rename(pct_change = `Percent change`) %>%
  mutate(type = "Historical") %>%
  select(Year, pct_change, type)

View(allfood_hist)

# Data wrangling + cleaning: All food CPI (Forecast: 2025–2026 midpoints)
allfood_fc <- forecast_raw %>%
  filter(`Top-level` == "All food") %>%
  filter(is.na(Aggregate)) %>%
  filter(Attribute %in% c("Mid point of prediction interval 2025",
                          "Mid point of prediction interval 2026")) %>%
  mutate(
    Year       = parse_number(Attribute),
    pct_change = Value,
    type       = "Forecast"
  ) %>%
  select(Year, pct_change, type)

View(allfood_fc)

# Combine datasets: All food CPI (Historical + Forecast)
allfood_cpi <- bind_rows(allfood_hist, allfood_fc) %>%
  arrange(Year)

View(allfood_cpi)

# Helper datasets for Plot 1: make the dashed forecast line start at 2024 (last historical year)
forecast_line <- allfood_hist %>%
  filter(Year == 2024) %>%
  mutate(type = "Forecast") %>%
  bind_rows(allfood_fc %>%
              mutate(type = "Forecast"))

lines_df <- bind_rows(
  allfood_hist %>% mutate(type = "Historical"),
  forecast_line
) %>%
  mutate(type = factor(type, levels = c("Historical", "Forecast")))

points_df <- bind_rows(
  allfood_hist %>% mutate(type = "Historical"),
  allfood_fc   %>% mutate(type = "Forecast")
) %>%
  mutate(type = factor(type, levels = c("Historical", "Forecast")))

# Plot 1: All food CPI percent change over time
food_cpi_plot <- ggplot(lines_df,
                        aes(x = Year,
                            y = pct_change,
                            linetype = type,
                            color    = type)) +
  geom_line(linewidth = 1) +
  geom_point(data = points_df,
             aes(x = Year, y = pct_change,
                 color = type),
             size = 2) +
  scale_linetype_manual(
    name   = "Data type",
    breaks = c("Historical", "Forecast"),
    values = c("Historical" = "solid",
               "Forecast"   = "dashed"),
    labels = c("Historical values (2005–2024)",
               "Forecast values (2025–2026)")
  ) +
  scale_color_manual(
    name   = "Data type",
    breaks = c("Historical", "Forecast"),
    values = c("Historical" = "black",
               "Forecast"   = "blue"),
    labels = c("Historical values (2005–2024)",
               "Forecast values (2025–2026)")
  ) +
  labs(
    title    = "U.S. Food Inflation Rate (All food CPI Percent Change), 2005–2026",
    subtitle = "2005–2024 are historical All food CPI percent changes; 2025–2026 are USDA forecast midpoints",
    x        = "Year",
    y        = "Percent change (%)",
    caption  = "Source: USDA Economic Research Service, Food Price Outlook"
  ) +
  theme_minimal(base_size = 13) +
  theme(
    legend.position = "right",
    plot.title      = element_text(face = "bold"),
    plot.subtitle   = element_text(margin = margin(b = 8))
  )

food_cpi_plot

# Data wrangling + cleaning: Four categories (Eggs, Pork, Beef and veal, Fresh fruits)
items4 <- c("Eggs", "Pork", "Beef and veal", "Fresh fruits")

hist_4items <- historical_raw %>%
  filter(`Consumer Price Index item` %in% items4,
         Year >= 2005, Year <= 2024) %>%
  mutate(
    item       = `Consumer Price Index item`,
    Year       = as.integer(Year),
    pct_change = `Percent change`,
    type       = "Historical"
  ) %>%
  select(item, Year, pct_change, type)

View(hist_4items)

# Data wrangling + cleaning: Four categories forecast values (2025–2026 midpoints)
eggs_fc <- forecast_raw %>%
  filter(`Top-level` == "All food",
         Aggregate   == "Food at home",
         `Mid-level` == "Eggs",
         str_detect(Attribute, "Mid point of prediction interval")) %>%
  mutate(
    item       = "Eggs",
    Year       = parse_number(Attribute),
    pct_change = Value,
    type       = "Forecast"
  ) %>%
  filter(Year %in% c(2025, 2026)) %>%
  select(item, Year, pct_change, type)

pork_fc <- forecast_raw %>%
  filter(`Top-level` == "All food",
         Aggregate   == "Food at home",
         `Mid-level` == "Meats, poultry, and fish",
         `Low-level` == "Meats",
         Disaggregate == "Pork",
         str_detect(Attribute, "Mid point of prediction interval")) %>%
  mutate(
    item       = "Pork",
    Year       = parse_number(Attribute),
    pct_change = Value,
    type       = "Forecast"
  ) %>%
  filter(Year %in% c(2025, 2026)) %>%
  select(item, Year, pct_change, type)

beef_fc <- forecast_raw %>%
  filter(`Top-level` == "All food",
         Aggregate   == "Food at home",
         `Mid-level` == "Meats, poultry, and fish",
         `Low-level` == "Meats",
         Disaggregate == "Beef and veal",
         str_detect(Attribute, "Mid point of prediction interval")) %>%
  mutate(
    item       = "Beef and veal",
    Year       = parse_number(Attribute),
    pct_change = Value,
    type       = "Forecast"
  ) %>%
  filter(Year %in% c(2025, 2026)) %>%
  select(item, Year, pct_change, type)

freshfruits_fc <- forecast_raw %>%
  filter(`Top-level` == "All food",
         Aggregate   == "Food at home",
         `Mid-level` == "Fruits and vegetables",
         `Low-level` == "Fresh fruits and vegetables",
         `Disaggregate` == "Fresh fruits",
         str_detect(Attribute, "Mid point of prediction interval")) %>%
  mutate(
    item       = "Fresh fruits",
    Year       = parse_number(Attribute),
    pct_change = Value,
    type       = "Forecast"
  ) %>%
  filter(Year %in% c(2025, 2026)) %>%
  select(item, Year, pct_change, type)

fc_4items <- bind_rows(eggs_fc, pork_fc, beef_fc, freshfruits_fc)

View(fc_4items)

# Helper datasets for Plot 2: make the dashed forecast segment start at 2024 for each category
forecast_line_4items <- hist_4items %>%
  filter(Year == 2024) %>%
  mutate(type = "Forecast") %>%
  bind_rows(fc_4items)

lines_4items <- bind_rows(hist_4items, forecast_line_4items) %>%
  mutate(
    type = factor(type, levels = c("Historical", "Forecast")),
    item = factor(item, levels = c("Eggs", "Pork", "Beef and veal", "Fresh fruits"))
  )

points_4items <- bind_rows(hist_4items, fc_4items) %>%
  mutate(
    type = factor(type, levels = c("Historical", "Forecast")),
    item = factor(item, levels = c("Eggs", "Pork", "Beef and veal", "Fresh fruits"))
  )

# Plot 2: Four-category trend comparison
cpi_4items_plot <- ggplot(lines_4items,
                          aes(x = Year,
                              y = pct_change,
                              color    = item,
                              linetype = type)) +
  geom_line(linewidth = 1) +
  geom_point(data = points_4items,
             aes(shape = item, color = item),
             size = 2) +
  scale_linetype_manual(
    name   = "Data type",
    values = c("Historical" = "solid",
               "Forecast"   = "dashed"),
    labels = c("Historical (2005–2024)",
               "Forecast (2025–2026)")
  ) +
  scale_color_manual(
    name   = "Food category",
    values = c("Eggs"          = "orange",
               "Pork"          = "pink",
               "Beef and veal" = "darkgreen",
               "Fresh fruits"  = "yellow")
  ) +
  scale_shape_manual(
    name   = "Food category",
    values = c("Eggs"          = 16,
               "Pork"          = 17,
               "Beef and veal" = 15,
               "Fresh fruits"  = 18)
  ) +
  labs(
    title    = "Food Inflation by Category (CPI Percent Change), 2005–2026",
    subtitle = "Historical percent changes (2005–2024), plus USDA midpoint forecasts for 2025–2026",
    x        = "Year",
    y        = "Percent change (%)",
    caption  = "Source: USDA Economic Research Service, Food Price Outlook"
  ) +
  theme_minimal(base_size = 13) +
  theme(
    legend.position = "right",
    plot.title      = element_text(face = "bold"),
    plot.subtitle   = element_text(margin = margin(b = 8))
  )

cpi_4items_plot

# Data wrangling: combine historical + forecast for bar chart view
cpi_4items_all <- bind_rows(hist_4items, fc_4items) %>% 
  mutate(
    type = factor(type, levels = c("Historical", "Forecast")),
    item = factor(item, levels = c("Eggs", "Pork", "Beef and veal", "Fresh fruits"))
  )

# Plot 3: Grouped bar chart
cpi_4items_bar <- ggplot(
  cpi_4items_all,
  aes(x = factor(Year),
      y = pct_change,
      fill  = item,
      alpha = type)
) +
  geom_col(position = position_dodge(width = 0.8)) +
  scale_fill_manual(
    name   = "Food category",
    values = c("Eggs"          = "orange",
               "Pork"          = "firebrick",
               "Beef and veal" = "darkgreen",
               "Fresh fruits"  = "royalblue")
  ) +
  scale_alpha_manual(
    name   = "Data type",
    values = c("Historical" = 1,
               "Forecast"   = 0.5),
    labels = c("Historical (2005–2024)",
               "Forecast (2025–2026)")
  ) +
  labs(
    title    = "Food Inflation by Category (CPI Percent Change), 2005–2026",
    subtitle = "Bars show yearly percent changes; lighter bars indicate USDA midpoint forecasts for 2025–2026",
    x        = "Year",
    y        = "Percent change (%)",
    caption  = "Source: USDA Economic Research Service, Food Price Outlook"
  ) +
  theme_minimal(base_size = 13) +
  theme(
    legend.position = "right",
    plot.title      = element_text(face = "bold"),
    plot.subtitle   = element_text(margin = margin(b = 8)),
    axis.text.x     = element_text(angle = 45, hjust = 1)
  )

cpi_4items_bar

# Table: historical mean/min/max (2005–2024) + forecast midpoints (2025–2026)
summary_4items <- hist_4items %>%
  group_by(item) %>%
  summarise(
    mean_2005_2024 = mean(pct_change, na.rm = TRUE),
    min_2005_2024  = min(pct_change, na.rm = TRUE),
    max_2005_2024  = max(pct_change, na.rm = TRUE)
  ) %>%
  left_join(
    fc_4items %>%
      select(item, Year, pct_change) %>%
      tidyr::pivot_wider(
        names_from  = Year,
        values_from = pct_change,
        names_prefix = "forecast_"
      ),
    by = "item"
  ) %>%
  mutate(
    across(where(is.numeric), ~ round(.x, 1))
  ) %>%
  arrange(item)

summary_4items

# Table 1: cleaned version of the summary table
summary_4items_pretty <- summary_4items %>%
  rename(
    Item                 = item,
    `Mean 2005–2024 (%)` = mean_2005_2024,
    `Min 2005–2024 (%)`  = min_2005_2024,
    `Max 2005–2024 (%)`  = max_2005_2024,
    `Forecast 2025 (%)`  = forecast_2025,
    `Forecast 2026 (%)`  = forecast_2026
  ) %>%
  mutate(
    across(where(is.numeric), ~ round(.x, 1))
  ) %>%
  arrange(Item)

View(summary_4items_pretty)

# Table 2: three highest and three lowest historical inflation years (All food, 2005–2024)
allfood_extremes <- allfood_hist %>%
  select(Year, pct_change) %>%
  arrange(desc(pct_change)) %>%
  slice_head(n = 3) %>%
  mutate(Rank = paste0("Highest #", row_number())) %>%
  bind_rows(
    allfood_hist %>%
      select(Year, pct_change) %>%
      arrange(pct_change) %>%
      slice_head(n = 3) %>%
      mutate(Rank = paste0("Lowest #", row_number()))
  ) %>%
  mutate(pct_change = round(pct_change, 1)) %>%
  select(Rank, Year, pct_change) %>%
  arrange(desc(pct_change))

allfood_extremes_pretty <- allfood_extremes %>%
  rename(`Percent change (%)` = pct_change)

View(allfood_extremes_pretty)

# Plot 4: distribution of historical All food CPI percent changes (2005–2024)
allfood_dist_plot <- ggplot(allfood_hist, aes(x = pct_change)) +
  geom_histogram(
    binwidth = 1,
    boundary = 0,
    fill = "steelblue",
    color = "white",
    alpha = 0.7
  )+
  geom_density(aes(y = after_stat(density) * 1), linewidth = 1) +
  labs(
    title = "Distribution of U.S. Food Inflation Rate (All food CPI), 2005–2024",
    subtitle = "Histogram of yearly CPI percent changes with a density curve",
    x = "Percent change (%)",
    y = "Count",
    caption = "Source: USDA Economic Research Service, Food Price Outlook"
  ) +
  theme_minimal(base_size = 13)

allfood_dist_plot
```
