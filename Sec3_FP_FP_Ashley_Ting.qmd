---
title: "How Have Food CPI Trends Changed Over the Past Two Decades?"
author: "Ashley Song & Ting Huang"
date: "December 2025"

format:
  pdf:
    toc: true
    number-sections: true
    geometry:
      - margin=1in

execute:
  echo: false
  warning: false
  message: false
---

```{r setup}
#| echo: false
# Code Header: Written and Reviewed by Ashley Song and Ting Huang
# Following the Tidyverse Style Guide

library(tidyverse)
library(knitr)
```

# Introduction

Food price changes affect nearly everyone because food is a routine and unavoidable expense. In the United States, one common way to summarize changes in food prices over time is the Consumer Price Index (CPI), which tracks price changes for baskets of goods and services. In this project, we explored how food CPI percent changes have shifted over the last two decades by combining historical CPI percent changes with USDA midpoint forecast values.

Our guiding question is: **How have U.S. Food CPI trends changed over the past two decades?** To answer it, we (1) examine the overall “All food” CPI percent change trend from 2005–2026 (historical plus forecast), (2) compare trends across four food categories (Eggs, Pork, Beef and veal, and Fresh fruits), and (3) summarize each category’s historical distribution using descriptive statistics.

# Paradigms and Perspectives

## Data analysis perspective

Our data analysis work uses an **Exploratory Data Analysis (EDA)** perspective. The purpose of EDA is to look for patterns, variability, and notable features in the data before making strong claims. This perspective fits our question because food inflation can behave differently across years and categories, and visualizations help reveal changes in trend direction, volatility, and category-level differences.

## Coding perspective

Our coding work follows the **tidyverse / tidy data** perspective. This approach emphasizes readable pipelines, consistent verbs (e.g., `filter()`, `mutate()`, `summarise()`), and data stored in a long, structured format that supports plotting and summarizing. Using a consistent tidyverse style also helps make the report reproducible and easier for others to understand and rerun.

# Data Provenance

Our data come from the **USDA Economic Research Service (ERS) Food Price Outlook** datasets. We used two CSV files stored in the project repository:

1. A historical CPI percent change dataset (used to construct yearly values from **2005–2024**).
2. A forecast dataset that includes USDA midpoint forecast values for **2025–2026**.

The main quantity we analyze is **percent change**, which represents the annual percent change in CPI for a category. Because our files are included in the repository, the analysis can be reproduced on another machine by reading the CSVs using **relative paths** (rather than Desktop paths).

# FAIR and CARE Principles

## FAIR

**Findable:** The USDA ERS Food Price Outlook page clearly lists and organizes the datasets, and the data files are named and stored in the repository so others can locate them.  

**Accessible:** The data are publicly available from USDA ERS. A potential challenge is that dataset formats or download locations could change over time; storing the CSVs in the repo helps ensure stable access for reproduction.  

**Interoperable:** The data are provided in **CSV format**, which is widely supported across software tools. The forecast file also includes a structured hierarchy of attributes (top-level, aggregate, disaggregate), which supports flexible analysis across different categories.  

**Reusable:** The repository contains code that documents how data are imported, cleaned, and analyzed. This encourages reuse by allowing others to adapt the code to different categories or updated years.

## CARE

**Collective Benefit:** Understanding food inflation trends supports informed decision-making for consumers and provides broader context for public discussion about cost of living.  

**Authority to Control:** The datasets are produced and shared by USDA ERS. Because these are public, aggregate-level economic data, there is no individual-level ownership to manage within this project.  

**Responsibility:** We interpret percent changes carefully and avoid overclaiming causality. Our focus is describing patterns rather than assigning definitive causes.  

**Ethics:** The analysis uses aggregated CPI data (not human-subject data), which reduces privacy concerns. We still aim to communicate uncertainty responsibly, especially when describing forecast values.

# Description of Cases and Attributes

In our analysis, a typical “case” is a **year–category observation** that records the CPI percent change for a specific category in a specific year. For example, one case could be “Eggs in 2012” with its annual percent change. Across the full project, cases come from two sources: historical values (2005–2024) and forecast midpoint values (2025–2026).

The key attributes include **Year** (numeric time index), **pct_change** (annual CPI percent change), and **item** (food category for category-level analyses). We also create a derived attribute, **type**, which labels observations as either “Historical” or “Forecast” to support direct comparison in visualizations.

# Exploratory Data Analysis

## All food CPI trend (2005–2026)

Figure \@ref(fig:allfood-trend) shows the overall food inflation pattern (All food CPI percent change) over time. In terms of **EPT language**, the figure highlights the overall variability of food inflation across years (the data do not stay constant) and shows that the time series includes both moderate years and years with sharper changes. The dashed forecast segment provides a continuation into 2025–2026, which helps contextualize forecast midpoints relative to the historical distribution.

**Long description:** The plot is a time-series line graph with Year on the x-axis (2005–2026) and percent change on the y-axis. Historical values (2005–2024) are shown as a solid black line with points, while forecast values (2025–2026) are shown as a dashed blue line with points. The visual emphasizes changes in annual inflation over time and the transition from historical to forecast values.

```{r fig_allfood_trend}
#| echo: false
#| fig-cap: "All food CPI percent change (historical values and USDA forecast midpoints), 2005–2026."
#| fig-alt: "Time-series line chart of U.S. All food CPI percent change by year from 2005 to 2026. Historical values from 2005–2024 appear as a solid black line with points, and forecast midpoint values for 2025–2026 appear as a dashed blue line with points. The x-axis is Year and the y-axis is Percent change (%)."

# Code Header: Primary Author: Ting Huang | Reviewer: Ashley Song

# (Code runs here to produce the figure; code is hidden in the PDF body.)
# Install tidyverse 
library(tidyverse)
library(knitr)

historical_raw <- read_csv("Data Sources (CSV)/historicalcpi.csv")
forecast_raw   <- read_csv("Data Sources (CSV)/CPIForecast.csv")

allfood_hist <- historical_raw %>%
  filter(str_detect(`Consumer Price Index item`, "All food"),
         Year >= 2005, Year <= 2024) %>%
  mutate(Year = as.integer(Year)) %>%
  rename(pct_change = `Percent change`) %>%
  mutate(type = "Historical") %>%
  select(Year, pct_change, type)

allfood_fc <- forecast_raw %>%
  filter(`Top-level` == "All food") %>%
  filter(is.na(Aggregate)) %>%
  filter(Attribute %in% c("Mid point of prediction interval 2025",
                          "Mid point of prediction interval 2026")) %>%
  mutate(
    Year       = parse_number(Attribute),
    pct_change = Value,
    type       = "Forecast"
  ) %>%
  select(Year, pct_change, type)

forecast_line <- allfood_hist %>%
  filter(Year == 2024) %>%
  mutate(type = "Forecast") %>%
  bind_rows(allfood_fc %>% mutate(type = "Forecast"))

lines_df <- bind_rows(
  allfood_hist %>% mutate(type = "Historical"),
  forecast_line
) %>%
  mutate(type = factor(type, levels = c("Historical", "Forecast")))

points_df <- bind_rows(
  allfood_hist %>% mutate(type = "Historical"),
  allfood_fc   %>% mutate(type = "Forecast")
) %>%
  mutate(type = factor(type, levels = c("Historical", "Forecast")))

food_cpi_plot <- ggplot(lines_df,
                        aes(x = Year,
                            y = pct_change,
                            linetype = type,
                            color    = type)) +
  geom_line(linewidth = 1) +
  geom_point(data = points_df,
             aes(x = Year, y = pct_change,
                 color = type),
             size = 2) +
  scale_linetype_manual(
    name   = "Data type",
    breaks = c("Historical", "Forecast"),
    values = c("Historical" = "solid",
               "Forecast"   = "dashed"),
    labels = c("Historical values (2005–2024)",
               "Forecast values (2025–2026)")
  ) +
  scale_color_manual(
    name   = "Data type",
    breaks = c("Historical", "Forecast"),
    values = c("Historical" = "black",
               "Forecast"   = "blue"),
    labels = c("Historical values (2005–2024)",
               "Forecast values (2025–2026)")
  ) +
  labs(
    title    = "U.S. Food Inflation Rate (All food CPI Percent Change), 2005–2026",
    subtitle = "2005–2024 are historical All food CPI percent changes; 2025–2026 are USDA forecast midpoints",
    x        = "Year",
    y        = "Percent change (%)",
    caption  = "Source: USDA Economic Research Service, Food Price Outlook"
  ) +
  theme_minimal(base_size = 13) +
  theme(
    legend.position = "right",
    plot.title      = element_text(face = "bold"),
    plot.subtitle   = element_text(margin = margin(b = 8))
  )

food_cpi_plot
```

## Food CPI by category (Eggs, Pork, Beef and veal, Fresh fruits)

Figure \@ref(fig:category-lines) compares category-level food inflation trends. This visualization helps identify whether categories move together or show different levels of volatility. Using **EPT language**, we focus on differences in trend shape, the spread between categories in certain years, and whether some categories show sharper spikes or dips than others.

**Long description:** This is a multi-line time-series plot of four food categories. Each category is encoded using a unique color and point shape. Historical values are drawn with solid lines through 2024, and forecast values are shown with dashed extensions from 2024 to 2026. The plot supports comparisons of variability and relative magnitude across categories.

```{r fig_category_lines}
#| echo: false
#| fig-cap: "Food CPI percent change by category (historical values and USDA forecast midpoints), 2005–2026."
#| fig-alt: "Multi-line time-series plot of CPI percent change from 2005 to 2026 for Eggs, Pork, Beef and veal, and Fresh fruits. Historical values (2005–2024) are shown with solid lines and points, and forecast midpoints (2025–2026) are shown as dashed extensions. The x-axis is Year and the y-axis is Percent change (%). Colors and shapes distinguish food categories, and a legend identifies historical versus forecast line types."

# Code Header: Primary Author: Ting Huang | Reviewer: Ashley Song

items4 <- c("Eggs", "Pork", "Beef and veal", "Fresh fruits")

hist_4items <- historical_raw %>%
  filter(`Consumer Price Index item` %in% items4,
         Year >= 2005, Year <= 2024) %>%
  mutate(
    item       = `Consumer Price Index item`,
    Year       = as.integer(Year),
    pct_change = `Percent change`,
    type       = "Historical"
  ) %>%
  select(item, Year, pct_change, type)

eggs_fc <- forecast_raw %>%
  filter(`Top-level` == "All food",
         Aggregate   == "Food at home",
         `Mid-level` == "Eggs",
         str_detect(Attribute, "Mid point of prediction interval")) %>%
  mutate(
    item       = "Eggs",
    Year       = parse_number(Attribute),
    pct_change = Value,
    type       = "Forecast"
  ) %>%
  filter(Year %in% c(2025, 2026)) %>%
  select(item, Year, pct_change, type)

pork_fc <- forecast_raw %>%
  filter(`Top-level` == "All food",
         Aggregate   == "Food at home",
         `Mid-level` == "Meats, poultry, and fish",
         `Low-level` == "Meats",
         Disaggregate == "Pork",
         str_detect(Attribute, "Mid point of prediction interval")) %>%
  mutate(
    item       = "Pork",
    Year       = parse_number(Attribute),
    pct_change = Value,
    type       = "Forecast"
  ) %>%
  filter(Year %in% c(2025, 2026)) %>%
  select(item, Year, pct_change, type)

beef_fc <- forecast_raw %>%
  filter(`Top-level` == "All food",
         Aggregate   == "Food at home",
         `Mid-level` == "Meats, poultry, and fish",
         `Low-level` == "Meats",
         Disaggregate == "Beef and veal",
         str_detect(Attribute, "Mid point of prediction interval")) %>%
  mutate(
    item       = "Beef and veal",
    Year       = parse_number(Attribute),
    pct_change = Value,
    type       = "Forecast"
  ) %>%
  filter(Year %in% c(2025, 2026)) %>%
  select(item, Year, pct_change, type)

freshfruits_fc <- forecast_raw %>%
  filter(`Top-level` == "All food",
         Aggregate   == "Food at home",
         `Mid-level` == "Fruits and vegetables",
         `Low-level` == "Fresh fruits and vegetables",
         `Disaggregate` == "Fresh fruits",
         str_detect(Attribute, "Mid point of prediction interval")) %>%
  mutate(
    item       = "Fresh fruits",
    Year       = parse_number(Attribute),
    pct_change = Value,
    type       = "Forecast"
  ) %>%
  filter(Year %in% c(2025, 2026)) %>%
  select(item, Year, pct_change, type)

fc_4items <- bind_rows(eggs_fc, pork_fc, beef_fc, freshfruits_fc)

forecast_line_4items <- hist_4items %>%
  filter(Year == 2024) %>%
  mutate(type = "Forecast") %>%
  bind_rows(fc_4items)

lines_4items <- bind_rows(hist_4items, forecast_line_4items) %>%
  mutate(
    type = factor(type, levels = c("Historical", "Forecast")),
    item = factor(item, levels = c("Eggs", "Pork", "Beef and veal", "Fresh fruits"))
  )

points_4items <- bind_rows(hist_4items, fc_4items) %>%
  mutate(
    type = factor(type, levels = c("Historical", "Forecast")),
    item = factor(item, levels = c("Eggs", "Pork", "Beef and veal", "Fresh fruits"))
  )

cpi_4items_plot <- ggplot(lines_4items,
                          aes(x = Year,
                              y = pct_change,
                              color    = item,
                              linetype = type)) +
  geom_line(linewidth = 1) +
  geom_point(data = points_4items,
             aes(shape = item, color = item),
             size = 2) +
  scale_linetype_manual(
    name   = "Data type",
    values = c("Historical" = "solid",
               "Forecast"   = "dashed"),
    labels = c("Historical (2005–2024)",
               "Forecast (2025–2026)")
  ) +
  scale_color_manual(
    name   = "Food category",
    values = c("Eggs"          = "orange",
               "Pork"          = "pink",
               "Beef and veal" = "darkgreen",
               "Fresh fruits"  = "yellow")
  ) +
  scale_shape_manual(
    name   = "Food category",
    values = c("Eggs"          = 16,
               "Pork"          = 17,
               "Beef and veal" = 15,
               "Fresh fruits"  = 18)
  ) +
  labs(
    title    = "Food Inflation by Category (CPI Percent Change), 2005–2026",
    subtitle = "Historical percent changes (2005–2024), plus USDA midpoint forecasts for 2025–2026",
    x        = "Year",
    y        = "Percent change (%)",
    caption  = "Source: USDA Economic Research Service, Food Price Outlook"
  ) +
  theme_minimal(base_size = 13) +
  theme(
    legend.position = "right",
    plot.title      = element_text(face = "bold"),
    plot.subtitle   = element_text(margin = margin(b = 8))
  )

cpi_4items_plot
```

Figure \@ref(fig:category-bars) presents the same four categories in a grouped bar chart, which can make year-to-year comparisons more immediate. The alpha difference between historical and forecast values visually signals that forecast values should be interpreted with more caution. Using **EPT language**, this view emphasizes differences in relative height (magnitude) across categories within the same year.

**Long description:** The chart is a grouped bar chart with Year on the x-axis and percent change on the y-axis. Four colors represent food categories. Bars are grouped by year, and transparency distinguishes historical values from forecast values.

```{r fig_category_bars}
#| echo: false
#| fig-cap: "Grouped bar chart comparing CPI percent change across food categories, 2005–2026."
#| fig-alt: "Grouped bar chart of CPI percent change by year for Eggs, Pork, Beef and veal, and Fresh fruits from 2005 to 2026. Different colors represent categories, and bar transparency indicates data type: historical values are more opaque and forecast values are lighter. The x-axis is Year and the y-axis is Percent change (%)."

# Code Header: Primary Author: Ting Huang | Reviewer: Ashley Song

cpi_4items_all <- bind_rows(hist_4items, fc_4items) %>% 
  mutate(
    type = factor(type, levels = c("Historical", "Forecast")),
    item = factor(item, levels = c("Eggs", "Pork", "Beef and veal", "Fresh fruits"))
  )

cpi_4items_bar <- ggplot(
  cpi_4items_all,
  aes(x = factor(Year),
      y = pct_change,
      fill  = item,
      alpha = type)
) +
  geom_col(position = position_dodge(width = 0.8)) +
  scale_fill_manual(
    name   = "Food category",
    values = c("Eggs"          = "orange",
               "Pork"          = "firebrick",
               "Beef and veal" = "darkgreen",
               "Fresh fruits"  = "royalblue")
  ) +
  scale_alpha_manual(
    name   = "Data type",
    values = c("Historical" = 1,
               "Forecast"   = 0.5),
    labels = c("Historical (2005–2024)",
               "Forecast (2025–2026)")
  ) +
  labs(
    title    = "Food Inflation by Category (CPI Percent Change), 2005–2026",
    subtitle = "Bars show yearly percent changes; lighter bars indicate USDA midpoint forecasts for 2025–2026",
    x        = "Year",
    y        = "Percent change (%)",
    caption  = "Source: USDA Economic Research Service, Food Price Outlook"
  ) +
  theme_minimal(base_size = 13) +
  theme(
    legend.position = "right",
    plot.title      = element_text(face = "bold"),
    plot.subtitle   = element_text(margin = margin(b = 8)),
    axis.text.x     = element_text(angle = 45, hjust = 1)
  )

cpi_4items_bar
```

## Summary statistics table (descriptive statistics)

Table \@ref(tbl:summary-table) summarizes each category using the mean, minimum, and maximum historical CPI percent changes from 2005–2024. It also includes the USDA midpoint forecast values for 2025 and 2026. This table provides a compact comparison of typical inflation (mean), historical extremes (min/max), and near-term expectations (forecasts).

**Long description:** The table lists four rows (Eggs, Pork, Beef and veal, Fresh fruits). Columns include mean, minimum, and maximum percent change across 2005–2024, and two forecast columns for 2025 and 2026. Values are rounded to one decimal place to improve readability.

```{r tbl_summary_table}
#| echo: false
#| tbl-cap: "Summary statistics for CPI percent change by category (historical values 2005–2024) with USDA forecast midpoints for 2025–2026."
# Code Header: Primary Author: Ting Huang | Reviewer: Ashley Song

summary_4items <- hist_4items %>%
  group_by(item) %>%
  summarise(
    mean_2005_2024 = mean(pct_change, na.rm = TRUE),
    min_2005_2024  = min(pct_change, na.rm = TRUE),
    max_2005_2024  = max(pct_change, na.rm = TRUE)
  ) %>%
  left_join(
    fc_4items %>%
      select(item, Year, pct_change) %>%
      tidyr::pivot_wider(
        names_from  = Year,
        values_from = pct_change,
        names_prefix = "forecast_"
      ),
    by = "item"
  ) %>%
  mutate(
    across(where(is.numeric), ~ round(.x, 1))
  ) %>%
  arrange(item)

summary_4items_pretty <- summary_4items %>%
  rename(
    Item                 = item,
    `Mean 2005–2024 (%)` = mean_2005_2024,
    `Min 2005–2024 (%)`  = min_2005_2024,
    `Max 2005–2024 (%)`  = max_2005_2024,
    `Forecast 2025 (%)`  = forecast_2025,
    `Forecast 2026 (%)`  = forecast_2026
  ) %>%
  mutate(
    across(where(is.numeric), ~ round(.x, 1))
  ) %>%
  arrange(Item)

knitr::kable(summary_4items_pretty, align = "lcccccc")
```

# Discussion and Hypotheses

Across our visualizations, food inflation shows meaningful year-to-year variability and category-level differences. The All food trend provides a high-level view of overall food inflation dynamics, while the category plots show that specific food groups can behave differently across time. The summary table supports these patterns by compressing historical variability into descriptive statistics and placing forecast midpoint values alongside historical ranges.

We propose two plausible hypotheses for the observed patterns. First, category-level inflation could respond differently to shocks such as supply disruptions, input cost changes, or seasonal sensitivity (for example, categories with more volatile production conditions may show larger swings). Second, broader macroeconomic inflation conditions can raise many prices simultaneously, but the magnitude and timing can differ based on how each category’s production and distribution systems respond.

# Open Science and PCIP Documentation

This project follows Open Science principles by storing the data, code, and report source in a shared GitHub repository. The use of relative file paths, clear code comments, consistent style, and a structured report supports reproducibility. Collaboration tools (issues, branching, and pull requests) also support transparency and shared accountability.

**PCIP (Plan–Code–Interpret–Plan):**
- **Plan:** We defined a clear question and identified which CPI categories and years would best support meaningful comparisons.
- **Code:** We imported data, filtered to relevant categories and years, and created plots/tables using tidyverse workflows.
- **Interpret:** We described patterns using EPT language and connected category-level results back to the broader context of food inflation.
- **Plan (revise):** We refined visuals for readability and reproducibility (e.g., labeling, legends, and repo-stored data files).

# Author Contributions

- **Ashley Song:** Repository organization tasks (README/structure, reproducibility checks), additional reporting text and interpretation, and supporting analysis contributions.
- **Ting Huang:** Primary data wrangling workflow and creation of core visualizations; coordinated project analysis direction.
- **Both:** Interpreting results, checking rubric requirements, and integrating materials into the final report.

# Code Appendix

Below is the full code used to generate all results in this report.

```{r code_appendix_full}
#| echo: true
# Code Header: Primary Author: Ashley Song & Ting Huang | Reviewer: Both

# Install tidyverse 
library(tidyverse)
library(knitr)

# Load CPI data (reproducible within GitHub)
historical_raw <- read_csv("Data Sources (CSV)/historicalcpi.csv")
forecast_raw   <- read_csv("Data Sources (CSV)/CPIForecast.csv")

# Open both datasets in spreadsheet view (RStudio)
View(historical_raw) 
View(forecast_raw)   

# All food CPI (Historical: 2005–2024)
allfood_hist <- historical_raw %>%
  filter(str_detect(`Consumer Price Index item`, "All food"),
         Year >= 2005, Year <= 2024) %>%
  mutate(Year = as.integer(Year)) %>%
  rename(pct_change = `Percent change`) %>%
  mutate(type = "Historical") %>%
  select(Year, pct_change, type)

View(allfood_hist)

# All food CPI (Forecast midpoints: 2025–2026)
allfood_fc <- forecast_raw %>%
  filter(`Top-level` == "All food") %>%
  filter(is.na(Aggregate)) %>%
  filter(Attribute %in% c("Mid point of prediction interval 2025",
                          "Mid point of prediction interval 2026")) %>%
  mutate(
    Year       = parse_number(Attribute),
    pct_change = Value,
    type       = "Forecast"
  ) %>%
  select(Year, pct_change, type)

View(allfood_fc)

# Combine historical + forecast into one dataset
allfood_cpi <- bind_rows(allfood_hist, allfood_fc) %>%
  arrange(Year)

View(allfood_cpi)

# Build helper datasets so the forecast line starts at 2024 (last historical point)
forecast_line <- allfood_hist %>%
  filter(Year == 2024) %>%
  mutate(type = "Forecast") %>%
  bind_rows(allfood_fc %>%
              mutate(type = "Forecast"))

lines_df <- bind_rows(
  allfood_hist %>% mutate(type = "Historical"),
  forecast_line
) %>%
  mutate(type = factor(type, levels = c("Historical", "Forecast")))

points_df <- bind_rows(
  allfood_hist %>% mutate(type = "Historical"),
  allfood_fc   %>% mutate(type = "Forecast")
) %>%
  mutate(type = factor(type, levels = c("Historical", "Forecast")))

# Plot 1: All food CPI percent change (Historical vs Forecast)
food_cpi_plot <- ggplot(lines_df,
                        aes(x = Year,
                            y = pct_change,
                            linetype = type,
                            color    = type)) +
  geom_line(linewidth = 1) +
  geom_point(data = points_df,
             aes(x = Year, y = pct_change,
                 color = type),
             size = 2) +
  scale_linetype_manual(
    name   = "Data type",
    breaks = c("Historical", "Forecast"),
    values = c("Historical" = "solid",
               "Forecast"   = "dashed"),
    labels = c("Historical values (2005–2024)",
               "Forecast values (2025–2026)")
  ) +
  scale_color_manual(
    name   = "Data type",
    breaks = c("Historical", "Forecast"),
    values = c("Historical" = "black",
               "Forecast"   = "blue"),
    labels = c("Historical values (2005–2024)",
               "Forecast values (2025–2026)")
  ) +
  labs(
    title    = "U.S. Food Inflation Rate (All food CPI Percent Change), 2005–2026",
    subtitle = "2005–2024 are historical All food CPI percent changes; 2025–2026 are USDA forecast midpoints",
    x        = "Year",
    y        = "Percent change (%)",
    caption  = "Source: USDA Economic Research Service, Food Price Outlook"
  ) +
  theme_minimal(base_size = 13) +
  theme(
    legend.position = "right",
    plot.title      = element_text(face = "bold"),
    plot.subtitle   = element_text(margin = margin(b = 8))
  )

food_cpi_plot

# Four categories: Eggs, Pork, Beef and veal, Fresh fruits
items4 <- c("Eggs", "Pork", "Beef and veal", "Fresh fruits")

# Historical data for the four categories (2005–2024)
hist_4items <- historical_raw %>%
  filter(`Consumer Price Index item` %in% items4,
         Year >= 2005, Year <= 2024) %>%
  mutate(
    item       = `Consumer Price Index item`,
    Year       = as.integer(Year),
    pct_change = `Percent change`,
    type       = "Historical"
  ) %>%
  select(item, Year, pct_change, type)

View(hist_4items)

# Forecast midpoints for 2025–2026 for each category
eggs_fc <- forecast_raw %>%
  filter(`Top-level` == "All food",
         Aggregate   == "Food at home",
         `Mid-level` == "Eggs",
         str_detect(Attribute, "Mid point of prediction interval")) %>%
  mutate(
    item       = "Eggs",
    Year       = parse_number(Attribute),
    pct_change = Value,
    type       = "Forecast"
  ) %>%
  filter(Year %in% c(2025, 2026)) %>%
  select(item, Year, pct_change, type)

pork_fc <- forecast_raw %>%
  filter(`Top-level` == "All food",
         Aggregate   == "Food at home",
         `Mid-level` == "Meats, poultry, and fish",
         `Low-level` == "Meats",
         Disaggregate == "Pork",
         str_detect(Attribute, "Mid point of prediction interval")) %>%
  mutate(
    item       = "Pork",
    Year       = parse_number(Attribute),
    pct_change = Value,
    type       = "Forecast"
  ) %>%
  filter(Year %in% c(2025, 2026)) %>%
  select(item, Year, pct_change, type)

beef_fc <- forecast_raw %>%
  filter(`Top-level` == "All food",
         Aggregate   == "Food at home",
         `Mid-level` == "Meats, poultry, and fish",
         `Low-level` == "Meats",
         Disaggregate == "Beef and veal",
         str_detect(Attribute, "Mid point of prediction interval")) %>%
  mutate(
    item       = "Beef and veal",
    Year       = parse_number(Attribute),
    pct_change = Value,
    type       = "Forecast"
  ) %>%
  filter(Year %in% c(2025, 2026)) %>%
  select(item, Year, pct_change, type)

freshfruits_fc <- forecast_raw %>%
  filter(`Top-level` == "All food",
         Aggregate   == "Food at home",
         `Mid-level` == "Fruits and vegetables",
         `Low-level` == "Fresh fruits and vegetables",
         `Disaggregate` == "Fresh fruits",
         str_detect(Attribute, "Mid point of prediction interval")) %>%
  mutate(
    item       = "Fresh fruits",
    Year       = parse_number(Attribute),
    pct_change = Value,
    type       = "Forecast"
  ) %>%
  filter(Year %in% c(2025, 2026)) %>%
  select(item, Year, pct_change, type)

# Combine the four category forecasts (8 rows total)
fc_4items <- bind_rows(eggs_fc, pork_fc, beef_fc, freshfruits_fc)

View(fc_4items)

# Make the dashed forecast segment start at 2024 for each category
forecast_line_4items <- hist_4items %>%
  filter(Year == 2024) %>%
  mutate(type = "Forecast") %>%
  bind_rows(fc_4items)

lines_4items <- bind_rows(hist_4items, forecast_line_4items) %>%
  mutate(
    type = factor(type, levels = c("Historical", "Forecast")),
    item = factor(item, levels = c("Eggs", "Pork", "Beef and veal", "Fresh fruits"))
  )

points_4items <- bind_rows(hist_4items, fc_4items) %>%
  mutate(
    type = factor(type, levels = c("Historical", "Forecast")),
    item = factor(item, levels = c("Eggs", "Pork", "Beef and veal", "Fresh fruits"))
  )

# Plot 2: Four-category trend comparison (color + shape by category, dashed forecasts)
cpi_4items_plot <- ggplot(lines_4items,
                          aes(x = Year,
                              y = pct_change,
                              color    = item,
                              linetype = type)) +
  geom_line(linewidth = 1) +
  geom_point(data = points_4items,
             aes(shape = item, color = item),
             size = 2) +
  scale_linetype_manual(
    name   = "Data type",
    values = c("Historical" = "solid",
               "Forecast"   = "dashed"),
    labels = c("Historical (2005–2024)",
               "Forecast (2025–2026)")
  ) +
  scale_color_manual(
    name   = "Food category",
    values = c("Eggs"          = "orange",
               "Pork"          = "pink",
               "Beef and veal" = "darkgreen",
               "Fresh fruits"  = "yellow")
  ) +
  scale_shape_manual(
    name   = "Food category",
    values = c("Eggs"          = 16,
               "Pork"          = 17,
               "Beef and veal" = 15,
               "Fresh fruits"  = 18)
  ) +
  labs(
    title    = "Food Inflation by Category (CPI Percent Change), 2005–2026",
    subtitle = "Historical percent changes (2005–2024), plus USDA midpoint forecasts for 2025–2026",
    x        = "Year",
    y        = "Percent change (%)",
    caption  = "Source: USDA Economic Research Service, Food Price Outlook"
  ) +
  theme_minimal(base_size = 13) +
  theme(
    legend.position = "right",
    plot.title      = element_text(face = "bold"),
    plot.subtitle   = element_text(margin = margin(b = 8))
  )

cpi_4items_plot

# Combine historical + forecast for bar chart view
cpi_4items_all <- bind_rows(hist_4items, fc_4items) %>% 
  mutate(
    type = factor(type, levels = c("Historical", "Forecast")),
    item = factor(item, levels = c("Eggs", "Pork", "Beef and veal", "Fresh fruits"))
  )

# Plot 3: Grouped bar chart (alpha indicates historical vs forecast)
cpi_4items_bar <- ggplot(
  cpi_4items_all,
  aes(x = factor(Year),
      y = pct_change,
      fill  = item,
      alpha = type)
) +
  geom_col(position = position_dodge(width = 0.8)) +
  scale_fill_manual(
    name   = "Food category",
    values = c("Eggs"          = "orange",
               "Pork"          = "firebrick",
               "Beef and veal" = "darkgreen",
               "Fresh fruits"  = "royalblue")
  ) +
  scale_alpha_manual(
    name   = "Data type",
    values = c("Historical" = 1,
               "Forecast"   = 0.5),
    labels = c("Historical (2005–2024)",
               "Forecast (2025–2026)")
  ) +
  labs(
    title    = "Food Inflation by Category (CPI Percent Change), 2005–2026",
    subtitle = "Bars show yearly percent changes; lighter bars indicate USDA midpoint forecasts for 2025–2026",
    x        = "Year",
    y        = "Percent change (%)",
    caption  = "Source: USDA Economic Research Service, Food Price Outlook"
  ) +
  theme_minimal(base_size = 13) +
  theme(
    legend.position = "right",
    plot.title      = element_text(face = "bold"),
    plot.subtitle   = element_text(margin = margin(b = 8)),
    axis.text.x     = element_text(angle = 45, hjust = 1)
  )

cpi_4items_bar

# Summary table: historical mean/min/max (2005–2024) + forecast midpoints (2025–2026)
summary_4items <- hist_4items %>%
  group_by(item) %>%
  summarise(
    mean_2005_2024 = mean(pct_change, na.rm = TRUE),
    min_2005_2024  = min(pct_change, na.rm = TRUE),
    max_2005_2024  = max(pct_change, na.rm = TRUE)
  ) %>%
  left_join(
    fc_4items %>%
      select(item, Year, pct_change) %>%
      tidyr::pivot_wider(
        names_from  = Year,
        values_from = pct_change,
        names_prefix = "forecast_"
      ),
    by = "item"
  ) %>%
  mutate(
    across(where(is.numeric), ~ round(.x, 1))
  ) %>%
  arrange(item)

summary_4items

# Cleaned version of the summary table
summary_4items_pretty <- summary_4items %>%
  rename(
    Item                 = item,
    `Mean 2005–2024 (%)` = mean_2005_2024,
    `Min 2005–2024 (%)`  = min_2005_2024,
    `Max 2005–2024 (%)`  = max_2005_2024,
    `Forecast 2025 (%)`  = forecast_2025,
    `Forecast 2026 (%)`  = forecast_2026
  ) %>%
  mutate(
    across(where(is.numeric), ~ round(.x, 1))
  ) %>%
  arrange(Item)

View(summary_4items_pretty)
```

# References

USDA Economic Research Service (ERS). Food Price Outlook datasets. https://www.ers.usda.gov/data-products/food-price-outlook
